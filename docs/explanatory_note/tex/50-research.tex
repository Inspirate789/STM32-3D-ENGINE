\chapter{Экспериментально-исследовательский раздел}
%\chapter{Заключение}
%\label{cha:research}

%В данном разделе проводятся вычислительные эксперименты.
%А на рис.~\ref{fig:spire01} показана схема мыслительного процесса автора...

%\begin{figure}
 % \centering
 % \caption{Как страшно жить}
 % \label{fig:spire01}
%\end{figure}

В данном разделе будет произведено исследование разработанного программного обеспечения с целью определения возможностей применения 
микроконтроллеров семейства STM32 для решения задач компьютерной графики.

\section{Цель проводимых измерений}
Для программы, которая должна выполняться на микроконтроллере, обладающем сравнительно небольшой вычислительной мощностью, критически 
важен фактор быстродействия. Особенно он важен при изображении сцены, содержащей большое количество объектов. В связи с этим очень 
важно понимать, как оборудование, исполняющее разработанную программу, будет справляться с увеличением нагрузки и как при этом 
будет изменяться ресурсоёмкость реализованных алгоритмов.

Целью проводимых измерений будет проведение нагрузочного тестирования и установление зависимости между числом объектов на сцене и затратами 
времени и памяти на работу алгоритма визуализации.



\section{Описание проводимых измерений}
Для установления зависимости между числом объектов на сцене и временем работы алгоритма будут произведены замеры времени при 
визуализации трёх моделей, содержащих 312, 1172 и 6228 полигонов. Изображения моделей приведены в приложении \ref{cha:appendix4}. 
В самом начале будет произведён замер времени визуализации небольшой части модели, а затем к ней постепенно будут добавляться 
новые полигоны до тех пор, пока число изображаемых полигонов не достигнет числа полигонов во всей модели и она не будет 
полностью изображена. Время будет замеряться в тактах процессора. Время высвечивания пикселей на дисплее учитываться не будет.

Замеры объёма памяти, необходимого для работы программы, будут произведены аналогично замерам времени, то есть путём исследования 
процесса визуализации отдельных фрагментов изображения. В процессе визуализации каждого фрагмента будет фиксироваться максимальный 
объём затраченной оперативной памяти. В этот объём входят данные об изображаемых моделях, а также статическая и динамическая память, 
используемая программой в процессе выполнения. Объём скомпилированного кода программы учитываться не будет, так как он хранится 
не в оперативной, а в постоянной памяти микроконтроллера.

Для проведения измерений будет использоваться модель микроконтроллера STM32F767ZI \cite{STM32F767ZI}, обладающая следующими 
техническими характеристиками:
\begin{itemize}
	\item модель процессора - Arm Cortex-M7 \cite{cortex_m7};
	\item тактовая частота процессора - 216 МГц;
	\item объём флеш-памяти - 2 Мб;
    \item объём оперативной памяти - 512 Кб.
\end{itemize}

Для просмотра получившихся изображений будет использоваться TFT-дисплей с разрешением 320x240 пикселей на базе чипа ILI9341 \cite{ili9341}.



\section{Инструменты измерения времени работы программы}
Для измерения реального времени процессора, затраченного на выполнение алгоритма визуализации трёхмерной сцены, будет использоваться 
отладочный модуль DWT \cite{dwt}. Данный модуль предосталяет функционал для профилирования работы процессора, в частности для замера 
количества тактов процессора, прошедших с момента начала работы программы.



\section{Результаты проведённых измерений}
Результаты измерений времени представлены на рисунке \ref{fig:measuring_time}.

% \begin{figure}[h]
%     \centering
%     \begin{subfloat}
%     {
%         \centering
        
%     }
%     \end{subfloat}
%     \hspace{10pt}       
%     \begin{subfloat}
%     {
%         \centering
        
%     }       
%     \end{subfloat}
%     \caption{Модель №1 (312 полигонов).}
%     \label{fig:tree_benchmark}
% \end{figure}

% \begin{figure}[h]
%     \centering
%     \begin{subfloat}
%     {
%         \centering
        
%     }
%     \end{subfloat}
%     \hspace{10pt}       
%     \begin{subfloat}
%     {
%         \centering
        
%     }       
%     \end{subfloat}
%     \caption{Модель №2 (1172 полигона).}
%     \label{fig:car_benchmark}
% \end{figure}

\begin{figure}[h]
    \centering
    \begin{subfloat}[Модель №1 (312 полигонов)]
    {
        \centering
        \begin{tikzpicture}
            \begin{axis}[width=0.47\textwidth, height=0.28\textheight,
                         xlabel={Количество полигонов},
                         ylabel={Количество тактов процессора}]
            \addplot table [x=count,y=cycles] {chart_tables/tree_time.txt};
            \end{axis}
        \end{tikzpicture}
    }
    \end{subfloat}
    \hspace{10pt}       
    \begin{subfloat}[Модель №2 (1172 полигона)]
    {
        \centering
        \begin{tikzpicture}
            \begin{axis}[width=0.46\textwidth, height=0.28\textheight,
                         xlabel={Количество полигонов},
                         ylabel={Количество тактов процессора}]
            \addplot table [x=count,y=cycles] {chart_tables/car_time.txt};
            \end{axis}
        \end{tikzpicture}
    }       
    \end{subfloat}
    \hspace{10pt}       
    \begin{subfloat}[Модель №3 (6228 полигонов)]
    {
        \centering
        \begin{tikzpicture}
            \begin{axis}[width=0.46\textwidth, height=0.28\textheight,
                         xlabel={Количество полигонов},
                         ylabel={Количество тактов процессора}]
            \addplot table [x=count,y=cycles] {chart_tables/plant_time.txt};
            \end{axis}
        \end{tikzpicture}
    }       
    \end{subfloat}
    \caption{Затраты времени на выполнение алгоритма визуализации}
    \label{fig:measuring_time}
\end{figure}

\newpage
Результаты измерений объёма памяти, необходимого программе, представлены на рисунке \ref{fig:measuring_memory}.

\begin{figure}[h]
    \centering
    \begin{subfloat}[Модель №1 (312 полигонов)]
    {
        \centering
        \begin{tikzpicture}
            \begin{axis}[width=0.47\textwidth, height=0.28\textheight,
                         xlabel={Количество полигонов},
                         ylabel={Объём памяти, Кб}]
            \addplot table [x=count,y=kilobytes] {chart_tables/tree_memory.txt};
            \end{axis}
        \end{tikzpicture}
    }
    \end{subfloat}
    \hspace{10pt}       
    \begin{subfloat}[Модель №2 (1172 полигона)]
    {
        \centering
        \begin{tikzpicture}
            \begin{axis}[width=0.46\textwidth, height=0.28\textheight,
                         xlabel={Количество полигонов},
                         ylabel={Объём памяти, Кб}]
            \addplot table [x=count,y=kilobytes] {chart_tables/car_memory.txt};
            \end{axis}
        \end{tikzpicture}
    }       
    \end{subfloat}
    \hspace{10pt}       
    \begin{subfloat}[Модель №3 (6228 полигонов)]
    {
        \centering
        \begin{tikzpicture}
            \begin{axis}[width=0.46\textwidth, height=0.28\textheight,
                         xlabel={Количество полигонов},
                         ylabel={Объём памяти, Кб}]
            \addplot table [x=count,y=kilobytes] {chart_tables/plant_memory.txt};
            \end{axis}
        \end{tikzpicture}
    }       
    \end{subfloat}
    \caption{Затраты памяти на выполнение алгоритма визуализации}
    \label{fig:measuring_memory}
\end{figure}



\newpage
\section{Вывод из экспериментально-исследовательского раздела}
В данном разделе было проведено исследование зависимости между числом объектов на сцене и ресурсоёмкостью алгоритма визуализации.

Результаты измерений показали, что зависимость затрат памяти на работу алгоритма от числа объектов на сцене является линейной. 
А зависимость затрат времени, предположительно, является кусочно-линейной. Коэффициент пропорциональности между числом объектов на сцене 
и временем работы алгоритма не является одинаковым на различных участках графиков, так как различные случаи взаимного расположения 
полигонов обрабатываются с разной скоростью. Увеличение времени работы алгоритма при добавлении на сцену очередного полигона зависит от 
того, будет ли он пересекаться с полигонами, которые уже находятся на сцене.

Также проведённые измерения показали, что оборудование, исполняющее разработанную программу, равномерно справляется с большой нагрузкой, 
так как зависимость между числом объектов на сцене и ресурсоёмкостью алгоритма является линейной на всех участках графиков. По результатам 
тестов, максимальное количество объектов (полигонов), которое микроконтроллер семейства STM32 позволяет обработать, превышает 6000.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "rpz"
%%% End:
